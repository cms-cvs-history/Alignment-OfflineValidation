process test = {
    source = EmptySource {}
    untracked PSet maxEvents = {untracked int32 input = 0}

    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

    include "FWCore/MessageLogger/data/MessageLogger.cfi"
    replace MessageLogger.cout = {
	untracked string threshold = "WARNING"
    }

    service = TFileService {
	string fileName = "muon_geometry.root"
    }

    include "Alignment/OfflineValidation/data/MuonGeometryIntoNtuples.cff"

#   To get a geometry from an SQLite file
#
#     include "CondCore/DBCommon/data/CondDBCommon.cfi"
#     es_source = PoolDBESSource {
# 	using CondDBCommon
# 	VPSet toGet = {
# 	    {
# 		string record = "DTAlignmentRcd"
# 		string tag = "DTAlignmentRcd_chambers"
# 	    },
# 	    {
# 		string record = "DTAlignmentErrorRcd"
# 		string tag = "DTAlignmentErrorRcd_chambers"
# 	    },
# 	    {
# 		string record = "CSCAlignmentRcd"
# 		string tag = "CSCAlignmentRcd_chambers"
# 	    },
# 	    {
# 		string record = "CSCAlignmentErrorRcd"
# 		string tag = "CSCAlignmentErrorRcd_chambers"
# 	    }
# 	}
#     }
#     replace PoolDBESSource.connect = "sqlite_file:chambers.db"
#     replace PoolDBESSource.catalog = "file:catalog.xml"

#     module fromAlignment = MuonGeometryIntoNtuples {
# 	bool DTApplyAlignment = true
# 	bool CSCApplyAlignment = true
# 	string DTAlignmentLabel = ""
# 	string CSCAlignmentLabel = ""
# 	bool DTFromSurveyRcd = false
# 	bool CSCFromSurveyRcd = false
	
# 	using MuonGeometryIntoNtupleNoScenario
#     }

    // https://twiki.cern.ch/twiki//bin/view/CMS/SWGuideMisalignmentTools
    include "Alignment/MuonAlignment/data/Scenarios.cff"

    module gaussian = MuonGeometryIntoNtuples {
	using MuonGeometryIntoNtupleNoDB

	bool ApplyMisalignmentScenario = true
	PSet MisalignmentScenario = {
	    int32 seed = 12345
	    string distribution = "gaussian"
	    bool setError = false
	    
	    PSet DTWheels = {
		PSet DTChambers = {
		    double dX = 0.01
		    double dY = 0.05
		    double dZ = 0.3
		    double phiXlocal = 0.002
		    double phiYlocal = 0.001
		    double phiZlocal = 0.0001
		}
	    }
	    
	    PSet CSCStations = {
		PSet CSCChambers = {
		    double dX = 0.01
		    double dY = 0.05
		    double dZ = 0.3
		    double phiXlocal = 0.002
		    double phiYlocal = 0.001
		    double phiZlocal = 0.0001
		}
	    }
	}
    }

    module ideal = MuonGeometryIntoNtuples {
	using MuonGeometryIntoNtupleNoDB

	bool ApplyMisalignmentScenario = true
	PSet MisalignmentScenario = {
	    int32 seed = 12345
	    string distribution = "fixed"
	    bool setError = false
	}
    }

    path p = {gaussian, ideal}
}
