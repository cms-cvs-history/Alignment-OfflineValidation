process before =
{
  include "CondCore/DBCommon/data/CondDBSetup.cfi"
  include "RecoTracker/TrackProducer/data/RefitterWithMaterial.cff"
  include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilderWithoutRefit.cfi"
  include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

  service = MessageLogger
  {
    untracked vstring destinations = {'cout'}

    untracked PSet cout = { untracked string threshold = 'WARNING' }
  }

  es_source = PoolDBESSource
  {
    using CondDBSetup

    string connect  = "oracle://cms_orcoff_int2r/CMS_COND_ALIGNMENT"
    string timetype = "runnumber"    

    VPSet toGet =
    {
      { string record = "TrackerAlignmentRcd"      string tag = "TrackerCSA07Scenario160" }, # replace tag in MillePede
      { string record = "TrackerAlignmentErrorRcd" string tag = "TrackerCSA07ScenarioErrors160" } # replace tag in MillePede
    }
  }

  replace CondDBSetup.catalog = "relationalcatalog_oracle://cms_orcoff_int2r/CMS_COND_GENERAL"

  replace TrackerDigiGeometryESModule.applyAlignment = true

  source = PoolSource
  { 
    untracked vstring fileNames = {"/store/trkalign/MC/AlCaReco/2007/TkAlZMuMu/DrellYan_mumu_40-CMSSW_1_5_4-RelVal-1186655029-Frontier-CMSSW_1_6_0_pre9/0000.root"}
  }

  untracked PSet maxEvents = { untracked int32 input = 1000 }

  module muons = ChargedCandidateProducer
  {
    InputTag src = TrackRefitter
    string particleType = "mu+"
  }

  module ZToMuMu = CandShallowCloneCombiner
  {
    string decay = "muons@+ muons@-"
    string cut = "70.0 < mass < 110.0"
  }

  module out = PoolOutputModule
  {
    untracked string fileName = "CSA07/ZMuMuBeforeAlignment.root"

    untracked vstring outputCommands =
    {
      "drop *",
      "keep *_ALCARECOTkAlZMuMu_*_*",
      "keep recoCandidatesOwned_*_*_*"
    }
  }

  replace TrackRefitter.src = ALCARECOTkAlZMuMu
  replace TrackRefitter.TTRHBuilder = "WithoutRefit"
  replace ttrhbwor.Matcher = "StandardMatcher"

  path p = { TrackRefitter, muons, ZToMuMu }

  endpath ep = { out }
}
