process MuonAlignmentMonitor =  {

  // Input reco file
  source = PoolSource {

	//AlCaReco File
    untracked vstring fileNames = {'/store/mc/CSA08/MuonPT11/ALCARECO/1PB_V2_RECO_MuAlZMuMu_v1/0029/04D75FB7-E624-DD11-A822-001D09F2437B.root'}   
	}
    untracked PSet maxEvents = {untracked int32 input = -1}

# Messages
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  # magnetic field
  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  # ideal geometry
  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
  include "Geometry/CommonDetUnit/data/bareGlobalTrackingGeometry.cfi"
  include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"
  include "Geometry/DTGeometry/data/dtGeometry.cfi"
  include "Geometry/CSCGeometry/data/cscGeometry.cfi"
  include "Geometry/RPCGeometry/data/rpcGeometry.cfi"
  include "RecoMuon/DetLayers/data/muonDetLayerGeometry.cfi"

# Muon alignment: from Frontier 
# it contain replaces
# Geometry to use in the extrapolator

include "CondCore/DBCommon/data/CondDBSetup.cfi"

es_source muonAlignment = PoolDBESSource {
    using CondDBSetup
    VPSet toGet = {
        { string record = "DTAlignmentRcd"           string tag = "DT1InversepbScenario200v1_mc" },
        { string record = "DTAlignmentErrorRcd"      string tag = "DT1InversepbScenarioErrors200v1_mc" },
        { string record = "CSCAlignmentRcd"          string tag = "CSC1InversepbScenario200v1_mc" },
        { string record = "CSCAlignmentErrorRcd"     string tag = "CSC1InversepbScenarioErrors200v1_mc" }
    }
    string timetype = "runnumber"

    # FRONTIER
    string connect="frontier://FrontierDev/CMS_COND_ALIGNMENT"

    # ORACLE
    #string connect = "oracle://cms_orcoff_prod/CMS_COND_20X_GLOBALTAG"
}


include "Alignment/CommonAlignmentProducer/data/GlobalPosition_Frontier_DevDB.cff"

replace DTGeometryESModule.applyAlignment = true
replace CSCGeometryESModule.applyAlignment = true

  // Analysis module
 module MuonAlignmentMonitor = MuonAlignmentAnalyzer {
        untracked string DataType = "RealData"
#       To do resolution plots:
#       untracked string DataType = "SimData"  # needs g4SimHits!!!

        # range of pt/mass histograms to analyze
        untracked double ptRangeMin = 0
        untracked double ptRangeMax = 300
        untracked double invMassRangeMin = 0
        untracked double invMassRangeMax = 200

        # InputTags for AlCaRecoMuon format
        untracked bool   doSAplots = false
        InputTag StandAloneTrackCollectionTag =  ALCARECOMuAlZMuMu:StandAlone

        untracked bool   doGBplots = false
        InputTag GlobalMuonTrackCollectionTag = ALCARECOMuAlZMuMu:GlobalMuon

        untracked bool   doResplots = true
        InputTag RecHits4DDTCollectionTag = dt4DSegments
        InputTag RecHits4DCSCCollectionTag = cscSegments

        #residual range limits: cm and rad
        untracked double resLocalXRangeStation1 = 0.1
        untracked double resLocalXRangeStation2 = 0.3
        untracked double resLocalXRangeStation3 = 3.0
        untracked double resLocalXRangeStation4 = 3.0
        untracked double resLocalYRangeStation1 = 0.7
        untracked double resLocalYRangeStation2 = 0.7
        untracked double resLocalYRangeStation3 = 5.0
        untracked double resLocalYRangeStation4 = 5.0
        untracked double resPhiRange           = 0.1
        untracked double resThetaRange         = 0.1
        untracked uint32 nbins                 = 500
        untracked uint32 min1DTrackRecHitSize   = 1
        untracked uint32 min4DTrackSegmentSize = 1
 }

  service = TFileService { 
    string fileName =  "MuonAlignmentMonitor.root"
  }

     path p = {MuonAlignmentMonitor}
}

